FROM jwduck/chocolatey:ltsc2019

# Restore the default Windows shell for correct batch processing.
SHELL ["cmd", "/S", "/C"]

# Download the Build Tools bootstrapper outside of the PATH.
ADD https://aka.ms/vs/15/release/vs_Enterprise.exe C:\\TEMP\\vs_Enterprise.exe

################################################################################
# Component IDs:
# Please see https://docs.microsoft.com/en-us/visualstudio/install/workload-component-id-vs-build-tools for more information
# on component IDs if there are any that need to be modified or added.
#
################################################################################
#
# MS Build Tools
#
# Microsoft.Component.MSBuild:                              MSBuild
# Microsoft.VisualStudio.Component.CoreBuildTools:              Visual Studio Build Tools Core
# Microsoft.VisualStudio.Component.Roslyn.Compiler:             C# and Visual Basic Roslyn compilers
#
# VC++ 2017
#
# Microsoft.VisualStudio.Component.VC.CoreBuildTools:               Visual C++ Build Tools core features
# Microsoft.VisualStudio.Component.VC.Redist.14.Latest:             Visual C++ 2017 Redistributable Update
# Microsoft.VisualStudio.Component.Windows10SDK:                    Windows Universal C Runtime
# Microsoft.VisualStudio.Component.Static.Analysis.Tools:           Static analysis tools
# Microsoft.VisualStudio.Component.VC.CMake.Project:                Visual C++ tools for CMake
# Microsoft.VisualStudio.Component.VC.Tools.x86.x64:                VC++ 2017 v141 toolset (x86,x64)
#
# UCRT
#
# Microsoft.Component.VC.Runtime.UCRTSDK:                           Windows Universal CRT SDK
# Microsoft.VisualStudio.ComponentGroup.NativeDesktop.Win81:        Windows 8.1 SDK and UCRT SDK
#
# VC++ Arm(64)
#
# Microsoft.VisualStudio.Component.VC.Tools.ARM:                    Visual C++ compilers and libraries for ARM
# Microsoft.VisualStudio.Component.VC.Tools.ARM64:                  Visual C++ compilers and libraries for ARM64
#
# .Net
#
# Microsoft.Net.Component.4.5.TargetingPack:                        .NET Framework 4.5 targeting pack
# Microsoft.VisualStudio.Component.PortableLibrary:                 .NET Portable Library targeting pack
#
# Microsoft.Net.Component.4.6.SDK:                                  .NET Framework 4.6 SDK
# Microsoft.Net.Component.4.6.TargetingPack:                        .NET Framework 4.6 targeting pack
# Microsoft.Net.ComponentGroup.TargetingPacks.Common:               .NET Framework 4 â€“ 4.6 development tools
#
# VC++ 2015
#
# Microsoft.VisualStudio.Component.VC.140:                          VC++ 2015.3 v140 toolset for desktop (x86,x64)
#
# Windows SDKs
# 
# Microsoft.VisualStudio.Component.Windows10SDK.16299.Desktop:      Windows 10 SDK (10.0.16299.0) for Desktop C++ [x86 and x64]
# Microsoft.VisualStudio.Component.Windows81SDK:                    Windows 8.1 SDK
# Microsoft.VisualStudio.Component.Windows10SDK.15063.Desktop:      Windows 10 SDK (10.0.15063.0) for Desktop C++ [x86 and x64]
# Microsoft.VisualStudio.Component.Windows10SDK.16299.Desktop.arm:  Windows 10 SDK (10.0.16299.0) for Desktop C++ [ARM and ARM64]

RUN C:\\TEMP\\vs_Enterprise.exe --wait --quiet --norestart --nocache --installPath C:\BuildTools \
####
#   VC++ Components
####
    --add Microsoft.VisualStudio.Component.VC.CoreBuildTools \
    --add Microsoft.VisualStudio.Component.VC.Redist.14.Latest \
    --add Microsoft.VisualStudio.Component.Windows10SDK \
    --add Microsoft.VisualStudio.Component.VC.Tools.x86.x64 \
    || IF "%ERRORLEVEL%"=="3010" EXIT 0

RUN C:\\TEMP\\vs_Enterprise.exe modify --wait --quiet --norestart --nocache --installPath C:\BuildTools \
####
#   UCRT
####
    --add Microsoft.Component.VC.Runtime.UCRTSDK \
####
    || IF "%ERRORLEVEL%"=="3010" EXIT 0

RUN C:\\TEMP\\vs_Enterprise.exe modify --wait --quiet --norestart --nocache --installPath C:\BuildTools \
####
#   Windows SDK
####
    --add Microsoft.VisualStudio.Component.Windows10SDK.16299.Desktop \
    --add Microsoft.VisualStudio.Component.Windows81SDK \
    --add Microsoft.VisualStudio.Component.Windows10SDK.15063.Desktop \
    || IF "%ERRORLEVEL%"=="3010" EXIT 0


# Start developer command prompt with any other commands specified.
ENTRYPOINT C:\BuildTools\Common7\Tools\VsDevCmd.bat && cmd.exe